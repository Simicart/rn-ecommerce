{"version":3,"sources":["asyncActions.js"],"names":["BrowserPersistence","removeCart","clearCheckoutDataFromStorage","actions","storage","signOut","payload","thunk","dispatch","revokeToken","error","console","clearToken","reset","getUserDetails","fetchUserDetails","args","getState","user","isSignedIn","getDetails","request","data","receive","customer","resetPassword","email","Promise","resolve","setToken","token","setItem","removeItem"],"mappings":"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","sourcesContent":["import BrowserPersistence from '../../../util/simplePersistence';\nimport { removeCart } from '../cart';\nimport { clearCheckoutDataFromStorage } from '../checkout';\n\nimport actions from './actions';\n\nconst storage = new BrowserPersistence();\n\nexport const signOut = (payload = {}) =>\n    async function thunk(dispatch) {\n        const { revokeToken } = payload;\n\n        if (revokeToken) {\n            // Send mutation to revoke token.\n            try {\n                await revokeToken();\n            } catch (error) {\n                console.error('Error Revoking Token', error);\n            }\n        }\n\n        // Remove token from local storage and Redux.\n        await dispatch(clearToken());\n        await dispatch(actions.reset());\n        await clearCheckoutDataFromStorage();\n\n        // Now that we're signed out, forget the old (customer) cart.\n        // We don't need to create a new cart here because we're going to refresh\n        // the page immediately after.\n        await dispatch(removeCart());\n    };\n\nexport const getUserDetails = ({ fetchUserDetails }) =>\n    async function thunk(...args) {\n        const [dispatch, getState] = args;\n        const { user } = getState();\n\n        if (user.isSignedIn) {\n            dispatch(actions.getDetails.request());\n\n            try {\n                const { data } = await fetchUserDetails();\n\n                dispatch(actions.getDetails.receive(data.customer));\n            } catch (error) {\n                dispatch(actions.getDetails.receive(error));\n            }\n        }\n    };\n\nexport const resetPassword = ({ email }) =>\n    async function thunk(...args) {\n        const [dispatch] = args;\n\n        dispatch(actions.resetPassword.request());\n\n        // TODO: actually make the call to the API.\n        // For now, just return a resolved promise.\n        await Promise.resolve(email);\n\n        dispatch(actions.resetPassword.receive());\n    };\n\nexport const setToken = token =>\n    async function thunk(...args) {\n        const [dispatch] = args;\n\n        // Store token in local storage.\n        // TODO: Get correct token expire time from API\n        storage.setItem('signin_token', token, 3600);\n\n        // Persist in store\n        dispatch(actions.setToken(token));\n    };\n\nexport const clearToken = () =>\n    async function thunk(...args) {\n        const [dispatch] = args;\n\n        // Clear token from local storage\n        storage.removeItem('signin_token');\n\n        // Remove from store\n        dispatch(actions.clearToken());\n    };\n"]}