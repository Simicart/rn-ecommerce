{"version":3,"sources":["useMiniCart.js"],"names":["useCallback","useMemo","useHistory","useQuery","useMutation","useCartContext","deriveErrorMessage","useMiniCart","props","setIsOpen","queries","mutations","miniCartQuery","removeItemMutation","cartId","history","data","miniCartData","loading","miniCartLoading","fetchPolicy","nextFetchPolicy","variables","skip","removeItem","removeItemLoading","called","removeItemCalled","error","removeItemError","totalQuantity","cart","total_quantity","subTotal","prices","subtotal_excluding_tax","productList","items","closeMiniCart","handleRemoveItem","id","itemId","e","handleProceedToCheckout","push","handleEditCart","derivedErrorMessage","errorMessage"],"mappings":"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","sourcesContent":["import { useCallback, useMemo } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { useQuery, useMutation } from '@apollo/client';\n\nimport { useCartContext } from '../../context/cart';\nimport { deriveErrorMessage } from '../../util/deriveErrorMessage';\n\n/**\n *\n * @param {Function} props.setIsOpen - Function to toggle the mini cart\n * @param {DocumentNode} props.queries.miniCartQuery - Query to fetch mini cart data\n * @param {DocumentNode} props.mutations.removeItemMutation - Mutation to remove an item from cart\n *\n * @returns {\n *      closeMiniCart: Function,\n *      errorMessage: String,\n *      handleEditCart: Function,\n *      handleProceedToCheckout: Function,\n *      handleRemoveItem: Function,\n *      loading: Boolean,\n *      productList: Array<>,\n *      subTotal: Number,\n *      totalQuantity: Number\n *  }\n */\nexport const useMiniCart = props => {\n    const { setIsOpen, queries, mutations } = props;\n    const { miniCartQuery } = queries;\n    const { removeItemMutation } = mutations;\n\n    const [{ cartId }] = useCartContext();\n    const history = useHistory();\n\n    const { data: miniCartData, loading: miniCartLoading } = useQuery(\n        miniCartQuery,\n        {\n            fetchPolicy: 'cache-and-network',\n            nextFetchPolicy: 'cache-first',\n            variables: { cartId },\n            skip: !cartId\n        }\n    );\n\n    const [\n        removeItem,\n        {\n            loading: removeItemLoading,\n            called: removeItemCalled,\n            error: removeItemError\n        }\n    ] = useMutation(removeItemMutation);\n\n    const totalQuantity = useMemo(() => {\n        if (!miniCartLoading && miniCartData) {\n            return miniCartData.cart.total_quantity;\n        }\n    }, [miniCartData, miniCartLoading]);\n\n    const subTotal = useMemo(() => {\n        if (!miniCartLoading && miniCartData) {\n            return miniCartData.cart.prices.subtotal_excluding_tax;\n        }\n    }, [miniCartData, miniCartLoading]);\n\n    const productList = useMemo(() => {\n        if (!miniCartLoading && miniCartData) {\n            return miniCartData.cart.items;\n        }\n    }, [miniCartData, miniCartLoading]);\n\n    const closeMiniCart = useCallback(() => {\n        setIsOpen(false);\n    }, [setIsOpen]);\n\n    const handleRemoveItem = useCallback(\n        async id => {\n            try {\n                await removeItem({\n                    variables: {\n                        cartId,\n                        itemId: id\n                    }\n                });\n            } catch (e) {\n                // Error is logged by apollo link - no need to double log.\n            }\n        },\n        [cartId, removeItem]\n    );\n\n    const handleProceedToCheckout = useCallback(() => {\n        setIsOpen(false);\n        history.push('/checkout');\n    }, [history, setIsOpen]);\n\n    const handleEditCart = useCallback(() => {\n        setIsOpen(false);\n        history.push('/cart');\n    }, [history, setIsOpen]);\n\n    const derivedErrorMessage = useMemo(\n        () => deriveErrorMessage([removeItemError]),\n        [removeItemError]\n    );\n\n    return {\n        closeMiniCart,\n        errorMessage: derivedErrorMessage,\n        handleEditCart,\n        handleProceedToCheckout,\n        handleRemoveItem,\n        loading: miniCartLoading || (removeItemCalled && removeItemLoading),\n        productList,\n        subTotal,\n        totalQuantity\n    };\n};\n"]}