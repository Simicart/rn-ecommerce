{"version":3,"sources":["usePriceSummary.js"],"names":["useCallback","useHistory","useRouteMatch","useQuery","useCartContext","flattenData","data","subtotal","cart","prices","subtotal_excluding_tax","total","grand_total","discounts","giftCards","applied_gift_cards","taxes","applied_taxes","shipping","shipping_addresses","usePriceSummary","props","queries","getPriceSummary","cartId","history","match","isCheckout","error","loading","fetchPolicy","nextFetchPolicy","skip","variables","handleProceedToCheckout","push","hasError","hasItems","items","length","isLoading","flatData"],"mappings":"AAAA,SAASA,WAAT,QAA4B,OAA5B;AACA,SAASC,UAAT,EAAqBC,aAArB,QAA0C,kBAA1C;AACA,SAASC,QAAT,QAAyB,gBAAzB;AACA,SAASC,cAAT,QAA+B,qCAA/B;AAEA;;;;;;;;;;AASA,MAAMC,WAAW,GAAGC,IAAI,IAAI;AACxB,MAAI,CAACA,IAAL,EAAW,OAAO,EAAP;AACX,SAAO;AACHC,IAAAA,QAAQ,EAAED,IAAI,CAACE,IAAL,CAAUC,MAAV,CAAiBC,sBADxB;AAEHC,IAAAA,KAAK,EAAEL,IAAI,CAACE,IAAL,CAAUC,MAAV,CAAiBG,WAFrB;AAGHC,IAAAA,SAAS,EAAEP,IAAI,CAACE,IAAL,CAAUC,MAAV,CAAiBI,SAHzB;AAIHC,IAAAA,SAAS,EAAER,IAAI,CAACE,IAAL,CAAUO,kBAJlB;AAKHC,IAAAA,KAAK,EAAEV,IAAI,CAACE,IAAL,CAAUC,MAAV,CAAiBQ,aALrB;AAMHC,IAAAA,QAAQ,EAAEZ,IAAI,CAACE,IAAL,CAAUW;AANjB,GAAP;AAQH,CAVD;AAYA;;;;;;;;;;;;;;;;;;;;AAkBA,OAAO,MAAMC,eAAe,GAAGC,KAAK,IAAI;AACpC,QAAM;AACFC,IAAAA,OAAO,EAAE;AAAEC,MAAAA;AAAF;AADP,MAEFF,KAFJ;AAIA,QAAM,CAAC;AAAEG,IAAAA;AAAF,GAAD,IAAepB,cAAc,EAAnC;AACA,QAAMqB,OAAO,GAAGxB,UAAU,EAA1B,CANoC,CAOpC;;AACA,QAAMyB,KAAK,GAAGxB,aAAa,CAAC,WAAD,CAA3B;AACA,QAAMyB,UAAU,GAAG,CAAC,CAACD,KAArB;AAEA,QAAM;AAAEE,IAAAA,KAAF;AAASC,IAAAA,OAAT;AAAkBvB,IAAAA;AAAlB,MAA2BH,QAAQ,CAACoB,eAAD,EAAkB;AACvDO,IAAAA,WAAW,EAAE,mBAD0C;AAEvDC,IAAAA,eAAe,EAAE,aAFsC;AAGvDC,IAAAA,IAAI,EAAE,CAACR,MAHgD;AAIvDS,IAAAA,SAAS,EAAE;AACPT,MAAAA;AADO;AAJ4C,GAAlB,CAAzC;AASA,QAAMU,uBAAuB,GAAGlC,WAAW,CAAC,MAAM;AAC9CyB,IAAAA,OAAO,CAACU,IAAR,CAAa,WAAb;AACH,GAF0C,EAExC,CAACV,OAAD,CAFwC,CAA3C;AAIA,SAAO;AACHS,IAAAA,uBADG;AAEHE,IAAAA,QAAQ,EAAE,CAAC,CAACR,KAFT;AAGHS,IAAAA,QAAQ,EAAE/B,IAAI,IAAI,CAAC,CAACA,IAAI,CAACE,IAAL,CAAU8B,KAAV,CAAgBC,MAHjC;AAIHZ,IAAAA,UAJG;AAKHa,IAAAA,SAAS,EAAE,CAAC,CAACX,OALV;AAMHY,IAAAA,QAAQ,EAAEpC,WAAW,CAACC,IAAD;AANlB,GAAP;AAQH,CAhCM;AAkCP;;AAEA;;;;;;;;;;;;;AAaA;;;;;;;;;;;AAWA","sourcesContent":["import { useCallback } from 'react';\nimport { useHistory, useRouteMatch } from 'react-router-dom';\nimport { useQuery } from '@apollo/client';\nimport { useCartContext } from '@magento/peregrine/lib/context/cart';\n\n/**\n * @ignore\n *\n * Flattens query data into a simple object. We create this here rather than\n * having each line summary line component destructure its own data because\n * only the parent \"price summary\" component knows the data structure.\n *\n * @param {Object} data query data\n */\nconst flattenData = data => {\n    if (!data) return {};\n    return {\n        subtotal: data.cart.prices.subtotal_excluding_tax,\n        total: data.cart.prices.grand_total,\n        discounts: data.cart.prices.discounts,\n        giftCards: data.cart.applied_gift_cards,\n        taxes: data.cart.prices.applied_taxes,\n        shipping: data.cart.shipping_addresses\n    };\n};\n\n/**\n * This talon contains logic for a price summary component.\n * It performs effects and returns prop data for rendering the component.\n *\n * This talon performs the following effects:\n *\n * - Log a GraphQL error if it occurs when getting the price summary\n *\n * @function\n *\n * @param {Object} props\n * @param {PriceSummaryQueries} props.queries GraphQL queries for a price summary component.\n *\n * @returns {PriceSummaryTalonProps}\n *\n * @example <caption>Importing into your project</caption>\n * import { usePriceSummary } from '@magento/peregrine/lib/talons/CartPage/PriceSummary/usePriceSummary';\n */\nexport const usePriceSummary = props => {\n    const {\n        queries: { getPriceSummary }\n    } = props;\n\n    const [{ cartId }] = useCartContext();\n    const history = useHistory();\n    // We don't want to display \"Estimated\" or the \"Proceed\" button in checkout.\n    const match = useRouteMatch('/checkout');\n    const isCheckout = !!match;\n\n    const { error, loading, data } = useQuery(getPriceSummary, {\n        fetchPolicy: 'cache-and-network',\n        nextFetchPolicy: 'cache-first',\n        skip: !cartId,\n        variables: {\n            cartId\n        }\n    });\n\n    const handleProceedToCheckout = useCallback(() => {\n        history.push('/checkout');\n    }, [history]);\n\n    return {\n        handleProceedToCheckout,\n        hasError: !!error,\n        hasItems: data && !!data.cart.items.length,\n        isCheckout,\n        isLoading: !!loading,\n        flatData: flattenData(data)\n    };\n};\n\n/** JSDocs type definitions */\n\n/**\n * Query data flattened into a simple object.\n *\n * @typedef {Object} FlattenedData\n *\n * @property {String} subtotal Cart subtotal (excluding tax)\n * @property {String} total Cart grand total\n * @property {Array<Object>} discounts Discounts applied to the cart\n * @property {Array<Object>} giftCards Gift cards applied to the cart\n * @property {Array<Object>} taxes Taxes applied to the cart\n * @property {Array<Object>} shipping Shipping addresses associated with this cart\n */\n\n/**\n * GraphQL queries for price summary component.\n *\n * @typedef {Object} PriceSummaryQueries\n *\n * @property {GraphQLAST} getPriceSummary Query to get the price summary for a cart\n *\n * @see [priceSummary.js]{@link https://github.com/magento/pwa-studio/blob/develop/packages/venia-ui/lib/components/CartPage/PriceSummary/priceSummary.js}\n * for the queries used in Venia.\n */\n\n/**\n * Props used for rendering a price summary component.\n *\n * @typedef {Object} PriceSummaryTalonProps\n *\n * @property {function} handleProceedToCheckout Callback function which navigates the browser to the checkout\n * @property {boolean} hasError True if a GraphQL query returns an error. False otherwise.\n * @property {boolean} hasItems True if the cart has any items. False otherwise.\n * @property {boolean} isLoading True while the GraphQL query is still in flight. False otherwise.\n * @property {FlattenedData} flatData Query data that has been flattened into a simple object\n *\n */\n"]}