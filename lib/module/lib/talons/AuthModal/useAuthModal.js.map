{"version":3,"sources":["useAuthModal.js"],"names":["useCallback","useEffect","useState","useHistory","useApolloClient","useMutation","useUserContext","clearCartDataFromCache","clearCustomerDataFromCache","UNAUTHED_ONLY","useAuthModal","props","closeDrawer","showCreateAccount","showForgotPassword","showMainMenu","showMyAccount","showSignIn","signOutMutation","view","apolloClient","isSigningOut","setIsSigningOut","username","setUsername","currentUser","isSignedIn","signOut","revokeToken","history","email","includes","handleClose","handleCancel","handleCreateAccount","handleSignOut","go"],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { useApolloClient, useMutation } from '@apollo/client';\n\nimport { useUserContext } from '../../context/user';\nimport { clearCartDataFromCache } from '../../Apollo/clearCartDataFromCache';\nimport { clearCustomerDataFromCache } from '../../Apollo/clearCustomerDataFromCache';\n\nconst UNAUTHED_ONLY = ['CREATE_ACCOUNT', 'FORGOT_PASSWORD', 'SIGN_IN'];\n\n/**\n * Returns props necessary to render an AuthModal component.\n *\n * @param {object} props\n * @param {function} props.closeDrawer - callback that closes drawer\n * @param {function} props.showCreateAccount - callback that shows create account view\n * @param {function} props.showForgotPassword - callback that shows forgot password view\n * @param {function} props.showMainMenu - callback that shows main menu view\n * @param {function} props.showMyAccount - callback that shows my account view\n * @param {function} props.showSignIn - callback that shows signin view\n * @param {DocumentNode} props.signOutMutation - mutation to call when signing out\n * @param {string} props.view - string that represents the current view\n *\n * @return {{\n *  handleClose: function,\n *  handleCreateAccount: function,\n *  handleSignOut: function,\n *  setUsername: function,\n *  showCreateAccount: function,\n *  showForgotPassword: function,\n *  showMyAccount: function,\n *  username: string\n * }}\n */\nexport const useAuthModal = props => {\n    const {\n        closeDrawer,\n        showCreateAccount,\n        showForgotPassword,\n        showMainMenu,\n        showMyAccount,\n        showSignIn,\n        signOutMutation,\n        view\n    } = props;\n\n    const apolloClient = useApolloClient();\n    const [isSigningOut, setIsSigningOut] = useState(false);\n    const [username, setUsername] = useState('');\n    const [{ currentUser, isSignedIn }, { signOut }] = useUserContext();\n    const [revokeToken] = useMutation(signOutMutation);\n    const history = useHistory();\n\n    // If the user is authed, the only valid view is \"MY_ACCOUNT\".\n    // view an also be `MENU` but in that case we don't want to act.\n    useEffect(() => {\n        if (currentUser && currentUser.email && UNAUTHED_ONLY.includes(view)) {\n            showMyAccount();\n        }\n    }, [currentUser, showMyAccount, view]);\n\n    // If the user token was invalidated by way of expiration, we need to reset\n    // the view back to the main menu.\n    useEffect(() => {\n        if (!isSignedIn && view === 'MY_ACCOUNT' && !isSigningOut) {\n            showMainMenu();\n        }\n    }, [isSignedIn, isSigningOut, showMainMenu, view]);\n\n    const handleClose = useCallback(() => {\n        showMainMenu();\n        closeDrawer();\n    }, [closeDrawer, showMainMenu]);\n\n    const handleCancel = useCallback(() => {\n        showSignIn();\n    }, [showSignIn]);\n\n    const handleCreateAccount = useCallback(() => {\n        showMyAccount();\n    }, [showMyAccount]);\n\n    const handleSignOut = useCallback(async () => {\n        setIsSigningOut(true);\n\n        // Delete cart/user data from the redux store.\n        await signOut({ revokeToken });\n        await clearCartDataFromCache(apolloClient);\n        await clearCustomerDataFromCache(apolloClient);\n\n        // Refresh the page as a way to say \"re-initialize\". An alternative\n        // would be to call apolloClient.resetStore() but that would require\n        // a large refactor.\n        history.go(0);\n    }, [apolloClient, history, revokeToken, signOut]);\n\n    return {\n        handleCancel,\n        handleClose,\n        handleCreateAccount,\n        handleSignOut,\n        setUsername,\n        showCreateAccount,\n        showForgotPassword,\n        showMyAccount,\n        username\n    };\n};\n"]}